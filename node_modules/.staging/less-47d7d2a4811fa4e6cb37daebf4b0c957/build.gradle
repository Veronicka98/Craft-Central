import groovy.io.FileType
import org.apache.tools.ant.taskdefs.condition.Os
import org.gradle.api.tasks.Exec

buildscript {
    repositories {
        mavenCentral()
		jcenter()
    }
    dependencies {
        classpath 'com.eriwen:gradle-js-plugin:1.8.0'
		classpath 'com.moowork.gradle:gradle-grunt-plugin:0.2'
    }
}

apply plugin: 'js'
apply plugin: 'grunt'

repositories {
    mavenCentral()
}

configurations {
    rhino
}

dependencies {
    rhino 'org.mozilla:rhino:1.7R4'
}

project.ext {
    packageProps = new groovy.json.JsonSlurper().parseText(new File("package.json").toURL().text)
    failures = 0;
    rhinoTestSrc = "out/rhino-test-${packageProps.version}.js"
    testSrc = 'test/less'
    testOut = 'out/test'
}

task runGruntRhino(type: GruntTask) {
    gruntArgs = "rhino"
}

combineJs {
	dependsOn runGruntRhino
    source = ["dist/less-rhino-${packageProps.version}.js", "test/rhino/test-header.js","dist/lessc-rhino-${packageProps.version}.js"]
    dest = file(rhinoTestSrc)
}

task testRhino(type: 